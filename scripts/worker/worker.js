(()=>{var w=Object.defineProperty;var P=(s,a,r)=>a in s?w(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r;var t=(s,a,r)=>P(s,typeof a!="symbol"?a+"":a,r);var b=class{constructor(a,r=[]){t(this,"correcao");t(this,"projecaoTaxaJuros");t(this,"valorImovel");t(this,"valorEntrada");t(this,"taxaJurosAnual");t(this,"prazoMeses");t(this,"tabela");t(this,"seguroMensal");t(this,"taxaAdministracaoMensal");t(this,"amortizacoesExtraordinarias");this.valorImovel=a.valorImovel,this.valorEntrada=a.valorEntrada,this.taxaJurosAnual=a.taxaJurosAnual,this.prazoMeses=a.prazoMeses,this.tabela=a.tabela,this.correcao=a.correcao,this.projecaoTaxaJuros=a.projecaoTaxaJuros,this.seguroMensal=a.seguroMensal,this.taxaAdministracaoMensal=a.taxaAdministracaoMensal,this.amortizacoesExtraordinarias=r}calculate(){switch(this.tabela){case"sac":return this.calcularSAC();case"price":throw new Error("Tabela de amortiza\xE7\xE3o n\xE3o implementada");default:throw new Error("Tabela de amortiza\xE7\xE3o inv\xE1lida")}}calcularSAC(){if(this.prazoMeses<=0)throw new Error("Prazo inv\xE1lido");let a=this.valorImovel-this.valorEntrada,r=a,e=a/this.prazoMeses,o=0,i=0,d=0,n=[],l=Math.pow(1+this.taxaJurosAnual/100,1/12)-1;for(let m=1;m<=this.prazoMeses&&r>0;m++){let c=r*l;o+=c;let p=this.amortizacoesExtraordinarias.filter(v=>v.appliesTo(m)).reduce((v,E)=>v+E.valor,0),h=Math.min(e+p,r),y=Math.min(p,Math.max(h-e,0));i+=y;let z=this.seguroMensal+this.taxaAdministracaoMensal;d+=z;let A=h+c;r=Math.max(0,r-h),r<=0&&m<this.prazoMeses&&console.log("Financiamento quitado no m\xEAs ".concat(m)),n.push({valorParcela:A,valorJuros:c,valorAmortizacao:h,saldoDevedor:r,valorEncargo:A+z})}if(n.length===0)throw new Error("Nenhuma parcela gerada");return{valorFinanciado:a,valorParcelaInicial:n[0].valorEncargo,valorParcelaFinal:n[n.length-1].valorEncargo,evolucao:n,custoTotalEfetivo:a+o+d,valorTotalJuros:o,valorTotalAmortizado:i,seguroMensal:this.seguroMensal,taxaAdministracaoMensal:this.taxaAdministracaoMensal}}};var u=class s{constructor(a){this.valor=a}static create(a,r,e,o){switch(a){case"Mensal":return new x(o);case"Anual":return new g(o);case"Bienal":return new f(o);case"Outro":return new M(o,e,r);default:let i=a;throw new Error("Per\xEDodo de amortiza\xE7\xE3o inv\xE1lido: ".concat(i))}}static fromJSON(a){var e,o;let r=(o=(e=a.termMonths)!=null?e:a.prazoMeses)!=null?o:0;return s.create(a.type,r,a.input,a.valor)}static validateCustomInterval(a){M.parseIntervalString(a)}},x=class extends u{constructor(){super(...arguments);t(this,"type","Mensal")}appliesTo(){return!0}},g=class extends u{constructor(){super(...arguments);t(this,"type","Anual")}appliesTo(r){return r%12===0}},f=class extends u{constructor(){super(...arguments);t(this,"type","Bienal")}appliesTo(r){return r%24===0}},M=class s extends u{constructor(r,e,o){super(r);this.input=e;this.termMonths=o;t(this,"type","Outro");t(this,"ranges");this.ranges=s.parseIntervalString(e)}appliesTo(r){return r>this.termMonths?!1:this.ranges.some(e=>r>=e.start&&r<=e.end)}static parseIntervalString(r){let e=r==null?void 0:r.trim();if(!e)throw new Error("Intervalo personalizado \xE9 obrigat\xF3rio para amortiza\xE7\xF5es do tipo 'Outro'");let o=[],i=e.split(",");for(let d of i){let n=d.trim();if(n)if(n.includes("-")){let[l,m]=n.split("-"),c=Number(l),p=Number(m);if(!Number.isInteger(c)||!Number.isInteger(p)||c<=0||p<=0||c>p)throw new Error('Intervalo inv\xE1lido: "'.concat(n,'"'));o.push({start:c,end:p})}else{let l=Number(n);if(!Number.isInteger(l)||l<=0)throw new Error('M\xEAs inv\xE1lido: "'.concat(n,'"'));o.push({start:l,end:l})}}return o}};self.onmessage=s=>{try{let{data:a}=s,r=JSON.parse(a),e=r.amortizacoes.map(n=>u.fromJSON(n)),i=new b(r.valores,e).calculate(),d=JSON.stringify(i);postMessage({data:d})}catch(a){console.error(a),console.trace(a);let r=a instanceof Error?a.message:String(a);postMessage({error:r})}};})();
