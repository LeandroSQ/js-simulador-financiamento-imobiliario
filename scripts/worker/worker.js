(()=>{var A=Object.defineProperty;var y=(o,a,r)=>a in o?A(o,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[a]=r;var e=(o,a,r)=>y(o,typeof a!="symbol"?a+"":a,r);var h=class{constructor(a,r=[]){e(this,"valorImovel");e(this,"valorEntrada");e(this,"taxaJurosAnual");e(this,"prazoMeses");e(this,"tabela");e(this,"correcao");e(this,"projecaoTaxaJuros");e(this,"seguroMensal");e(this,"taxaAdministracaoMensal");e(this,"amortizacoesExtraordinarias");this.valorImovel=a.valorImovel,this.valorEntrada=a.valorEntrada,this.taxaJurosAnual=a.taxaJurosAnual,this.prazoMeses=a.prazoMeses,this.tabela=a.tabela,this.correcao=a.correcao,this.projecaoTaxaJuros=a.projecaoTaxaJuros,this.seguroMensal=a.seguroMensal,this.taxaAdministracaoMensal=a.taxaAdministracaoMensal,this.amortizacoesExtraordinarias=r}calculate(){switch(this.tabela){case"sac":return this.calcularSAC();case"price":throw new Error("Tabela de amortiza\xE7\xE3o n\xE3o implementada");default:throw new Error("Tabela de amortiza\xE7\xE3o inv\xE1lida")}}calcularSAC(){if(this.prazoMeses<=0)throw new Error("Prazo inv\xE1lido");let a=this.valorImovel-this.valorEntrada,r=a,s=a/this.prazoMeses,n=0,i=0,p=0,t=[],l=Math.pow(1+this.taxaJurosAnual/100,1/12)-1;for(let m=1;m<=this.prazoMeses&&r>0;m++){let c=r*l;n+=c;let d=this.amortizacoesExtraordinarias.filter(f=>f.appliesTo(m)).reduce((f,E)=>f+E.valor,0),b=Math.min(s+d,r);i+=b-s;let z=this.seguroMensal+this.taxaAdministracaoMensal;p+=z;let w=b+c;r=Math.max(0,r-b),r<=0&&m<this.prazoMeses&&console.log("Financiamento quitado no m\xEAs ".concat(m)),t.push({valorParcela:w,valorJuros:c,valorAmortizacao:b,saldoDevedor:r,valorEncargo:w+z})}if(t.length===0)throw new Error("Nenhuma parcela gerada");return{valorFinanciado:a,valorParcelaInicial:t[0].valorEncargo,valorParcelaFinal:t[t.length-1].valorEncargo,evolucao:t,custoTotalEfetivo:a+n+p,valorTotalJuros:n,valorTotalAmortizado:i,seguroMensal:this.seguroMensal,taxaAdministracaoMensal:this.taxaAdministracaoMensal}}};var u=class o{constructor(a){this.valor=a}static create(a,r,s,n){switch(a){case"Mensal":return new M(n);case"Anual":return new g(n);case"Bienal":return new x(n);case"Outro":return new v(n,s,r);default:let i=a;throw new Error("Per\xEDodo de amortiza\xE7\xE3o inv\xE1lido: ".concat(i))}}static fromJSON(a){var r;return o.create(a.type,(r=a.prazoMeses)!=null?r:0,a.input,a.valor)}static validateCustomInterval(a){v.parse(a)}},M=class extends u{constructor(){super(...arguments);e(this,"type","Mensal")}appliesTo(){return!0}},g=class extends u{constructor(){super(...arguments);e(this,"type","Anual")}appliesTo(r){return r%12===0}},x=class extends u{constructor(){super(...arguments);e(this,"type","Bienal")}appliesTo(r){return r%24===0}},v=class o extends u{constructor(r,s,n){super(r);this.input=s;this.prazoMeses=n;e(this,"type","Outro");e(this,"ranges");this.ranges=o.parse(s)}appliesTo(r){if(r>this.prazoMeses)return!1;for(let s of this.ranges)if(r>=s.start&&r<=s.end)return!0;return!1}static parse(r){let s=r==null?void 0:r.trim();if(!s)throw new Error("Intervalo personalizado \xE9 obrigat\xF3rio para amortiza\xE7\xF5es do tipo 'Outro'");let n=[],i=s.split(",");for(let p of i){let t=p.trim();if(t)if(t.includes("-")){let[l,m]=t.split("-"),c=Number(l),d=Number(m);if(!Number.isInteger(c)||!Number.isInteger(d)||c<=0||d<=0||c>d)throw new Error('Intervalo inv\xE1lido: "'.concat(t,'"'));n.push({start:c,end:d})}else{let l=Number(t);if(!Number.isInteger(l)||l<=0)throw new Error('M\xEAs inv\xE1lido: "'.concat(t,'"'));n.push({start:l,end:l})}}return n}};self.onmessage=o=>{try{let{data:a}=o,r=JSON.parse(a),s=r.amortizacoes.map(t=>u.fromJSON(t)),i=new h(r.valores,s).calculate(),p=JSON.stringify(i);postMessage({data:p})}catch(a){console.error(a),console.trace(a),a instanceof Error?postMessage({error:a.message}):postMessage({error:String(a)})}};})();
